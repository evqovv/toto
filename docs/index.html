<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preload" href="./assets/Sofia-Regular.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="./assets/ArefRuqaa-Regular.woff2" as="font" type="font/woff2" crossorigin>
  <title>toto</title>
  <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();class x{top;height;items=[];bottom=0;constructor(t,e){this.top=t,this.height=e,this.bottom=t+e}attach(t,e){this.items.push(t),t.set_style("top",this.compute_position(t,e))}detach(t){this.items=this.items.filter(e=>e!==t)}peek_last(){return this.items.length!==0?this.items[this.items.length-1]:null}cancel(){for(const t of[...this.items])t.plugin_system.lifecycle.end.emit(t)}compute_position(t,e){let i=0;switch(e){case"top":i=this.top;break;case"center":i=this.top+(this.height-t.height)/2;break;case"bottom":i=this.top+this.height-t.height;break;default:throw new Error("Unexpected alignment.")}return`${i}px`}}class S{constructor(){this.node=document.createElement("div"),this.apply_style({overflow:"hidden",position:"relative",top:"0",left:"0",width:"100%",height:"100%"})}apply_style(t){Object.assign(this.node.style,t)}mount(t){if(this.is_mounted())throw new Error("Container already mounted. Unmount before remounting.");t.appendChild(this.node),this.parent_node=t,this.format()}unmount(){this.is_mounted()&&(this.node.parentNode.removeChild(this.node),this.parent_node=null)}is_mounted(){return this.parent_node!==null}resize(){this.format()}format(){const t=this.node.getBoundingClientRect();Object.assign(this,{width:t.width,height:t.height})}node;parent_node=null;width=0;height=0}function C(n,t,e){const i=n.speed,s=t.speed,o=s-i,c=n.get_moved_distance()-n.width;if(c<0)return!1;if(i>=s)return c>=e;const u=(n.container_width-c+e)/i;return(c-e)/o>u}function O(n,t,e){return C(n,t,e)}class r{callbacks=[];tap(t){return this.callbacks.push(t),this}untap(t){return this.callbacks=this.callbacks.filter(e=>e!==t),this}emit(...t){[...this.callbacks].forEach(e=>e(...t))}}class z{lifecycle;constructor(t){this.lifecycle=t}use(t){for(const e in t){const i=this.lifecycle[e],s=t[e];i&&s&&i.tap(s)}}}function F(){return new z({start:new r,end:new r,pause:new r,resume:new r,cancel:new r,mount:new r,unmount:new r,format:new r,resize:new r})}function P(){return new z({$start:new r,$end:new r,$pause:new r,$resume:new r,$cancel:new r,$mount:new r,$unmount:new r,$format:new r,$resize:new r,start:new r,stop:new r,cancel:new r,freeze:new r,unfreeze:new r,mount:new r,unmount:new r,format:new r,resize:new r,finish:new r,screen_empty:new r})}function j(n){const t={};for(const e of Object.keys(n.lifecycle))if(e.startsWith("$")){const i=e.slice(1);t[i]=(...s)=>{n.lifecycle[e].emit(...s)}}return t}const f=()=>performance.now(),N=requestAnimationFrame;class y{options;constructor(t){this.options=t,this.apply_style(y.init_style),this.apply_style(t.style),this.duration=t.duration,this.direction=t.direction;for(const e of t.node)this.node.appendChild(t.clone_node?e.cloneNode(!0):e);this.node.addEventListener("transitionend",()=>this.plugin_system.lifecycle.end.emit(this))}play(){this.status==="idle"&&(this.recorder.start_time=f(),this.set_style("transition",`transform ${this.duration}ms linear`),this.set_style("transform",`translateX(${this.destination}px)`),this.status="running",this.plugin_system.lifecycle.start.emit(this))}pause(){if(this.status!=="running")return;this.recorder.last_paused_at=f();const e=this.direction==="to_left"?-1:1,i=this.get_moved_distance();this.set_style("transitionDuration","0ms"),this.set_style("transform",`translateX(${e*i}px)`),this.status="paused",this.plugin_system.lifecycle.pause.emit(this)}resume(){if(this.status!=="paused")return;this.recorder.paused_duration+=f()-this.recorder.last_paused_at;const t=this.duration-this.get_elapsed_time();this.recorder.last_paused_at=0,this.set_style("transitionDuration",`${t}ms`),this.set_style("transform",`translateX(${this.destination}px)`),this.status="running",this.plugin_system.lifecycle.resume.emit(this)}cancel(){this.status!=="idle"&&(this.set_style("transition",""),this.set_style("transform",""),Object.assign(this.recorder,{start_time:0,last_paused_at:0,paused_duration:0}),this.status="idle",this.plugin_system.lifecycle.cancel.emit(this))}resize(){if(!this.container_node)throw new Error("This item is not mounted yet.");const e=this.direction==="to_left"?-1:1,{width:i,height:s}=this.container_node.getBoundingClientRect(),o=this.get_elapsed_time(),a=i+this.width,c=o/this.duration,m=e*a*c,u=this.duration-o,h=e*a;this.set_style("transitionDuration","0ms"),this.set_style("transform",`translateX(${m}px)`),this.status==="running"&&N(()=>{this.set_style("transitionDuration",`${u}ms`),this.set_style("transform",`translateX(${h}px)`)}),Object.assign(this,{container_width:i,container_height:s,destination:h})}get_elapsed_time(){switch(this.status){case"idle":return 0;case"running":return f()-this.recorder.start_time-this.recorder.paused_duration;case"paused":return this.recorder.last_paused_at-this.recorder.start_time-this.recorder.paused_duration;default:throw new Error("Unexpected status.")}}get_moved_distance(){return this.get_elapsed_time()*this.speed}is_mounted(){return this.container_node!==null}mount(t){this.unmount(),this.container_node=t,this.container_node.appendChild(this.node),this.format()}unmount(){this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.container_node=null}set_style(t,e){this.node.style[t]=e}apply_style(t){Object.assign(this.node.style,t)}attach(t,e){this.track===null&&t.attach(this,e)}detach(){this.track!==null&&(this.track.detach(this),this.track=null)}format(){if(!this.container_node)throw new Error("This item is not mounted yet.");const{width:t,height:e}=this.node.getBoundingClientRect(),{width:i,height:s}=this.container_node.getBoundingClientRect(),o=this.direction==="to_left",a=o?-1:1;Object.assign(this,{width:t,height:e,container_width:i,container_height:s,total_distance:i+t,speed:(i+t)/this.duration,destination:a*(i+t)}),this.set_style(o?"right":"left",`${-this.width}px`)}width=0;height=0;plugin_system=F();container_width=0;container_height=0;duration=0;speed=0;direction;destination=0;status="idle";node=document.createElement("div");container_node=null;track=null;recorder={start_time:0,last_paused_at:0,paused_duration:0};static init_style={position:"absolute",whiteSpace:"nowrap",display:"flex",alignItems:"center",willChange:"transform"}}class D{options;container=new S;tracks=[];stash=[];set=new Set;constructor(t){this.options=t}format(){this.format_tracks()}add(t){this.stash.push(...t)}each(t){for(const e of this.set)t(e)}clear_stash(){this.stash.length=0}create_and_mount_danmaku(t){const e=new y(t);return e.mount(this.container.node),e}render(t,e){if(this.tracks.length===0||this.stash.length===0)return;const i=Math.min(this.stash.length,this.options.max_launch_count_per_tick,this.tracks.length);for(let s=0;s<i;s++){const o=this.stash.shift();if(!o)break;const a=this.create_and_mount_danmaku(o);if(a.height>this.options.track_height){a.unmount();break}const c=this.get_launchable_track(a);if(!c){a.unmount(),this.stash.unshift(o);continue}const m=()=>{a.detach(),this.set.delete(a),a.unmount()},u=()=>{this.set.size===0&&e.screen_empty.emit()},h=()=>{this.set.size===0&&this.stash.length===0&&e.finish.emit()};a.plugin_system.use(t),a.plugin_system.use({end:()=>{m(),u(),h()},cancel:()=>{m(),u(),h()}}),a.attach(c,this.options.alignment),a.play(),this.set.add(a),o.loop&&this.stash.push(o)}}resize(){this.each(e=>e.resize());const t=this.container.height;this.container.resize(),this.resize_tracks(t)}get_launchable_track(t){for(const e of this.tracks){const i=e.peek_last();if(!i||O(i,t,this.options.min_horizontal_gap))return e}return null}format_tracks(){const{max_row_count:t,track_height:e,min_vertical_gap:i}=this.options,{height:s}=this.container,o=Math.min(t,Math.floor((s+i)/(e+i))),a=e+i,c=(o-1)*a+e,u=Math.max(0,s-c)/2;for(let h=0;h<o;h++)this.tracks.push(new x(u+h*a,this.options.track_height))}resize_tracks(t){const e=this.container.height;if(e===t)return;e<t?this.shrink_tracks(e):this.expand_tracks(e)}shrink_tracks(t){for(let e=this.tracks.length-1;e>=0;e--){const i=this.tracks[e];i.bottom>t&&(i.cancel(),this.tracks.splice(e,1))}}expand_tracks(t){if(this.tracks.length===0){this.format_tracks();return}let i=this.tracks[this.tracks.length-1].bottom+this.options.min_vertical_gap;for(;i+this.options.track_height<=t;)this.tracks.push(new x(i,this.options.track_height)),i+=this.options.track_height+this.options.min_vertical_gap}}class M{options;plugin_system=P();status="idle";engine;render_timer=null;constructor(t){this.options=t,this.engine=new D(t)}push(t){this.engine.add(t)}until_all_done(){return new Promise(t=>this.plugin_system.lifecycle.finish.tap(()=>t()))}start_render(){if(this.status!=="idle")return;const t=()=>{this.render_timer=setTimeout(t,this.options.interval),this.engine.render(j(this.plugin_system),{finish:this.plugin_system.lifecycle.finish,screen_empty:this.plugin_system.lifecycle.screen_empty})};t(),this.status="rendering",this.plugin_system.lifecycle.start.emit()}stop_render(){this.status==="rendering"&&(this.render_timer&&clearTimeout(this.render_timer),this.render_timer=null,this.status="idle",this.plugin_system.lifecycle.stop.emit())}cancel(){this.stop_render(),this.engine.each(t=>t.cancel()),this.engine.clear_stash(),this.status="idle",this.plugin_system.lifecycle.cancel.emit()}graceful_stop(){return this.stop_render(),new Promise(t=>this.plugin_system.lifecycle.screen_empty.tap(()=>{t(),this.status="idle",this.plugin_system.lifecycle.stop.emit()}))}graceful_cancel(){return this.stop_render(),this.engine.clear_stash(),new Promise(t=>this.plugin_system.lifecycle.screen_empty.tap(()=>{t(),this.status="idle",this.plugin_system.lifecycle.cancel.emit()}))}freeze(){this.status==="rendering"&&(this.stop_render(),this.engine.each(t=>t.pause()),this.status="frozen",this.plugin_system.lifecycle.freeze.emit())}unfreeze(){this.status==="frozen"&&(this.engine.each(t=>t.resume()),this.start_render(),this.status="rendering",this.plugin_system.lifecycle.unfreeze.emit())}mount(t){this.engine.container.is_mounted()&&this.unmount(),this.engine.container.mount(t),this.format(),this.plugin_system.lifecycle.mount.emit(t)}unmount(){if(!this.engine.container.is_mounted())return;const t=this.engine.container.parent_node;this.engine.container.unmount(),this.plugin_system.lifecycle.mount.emit(t)}resize(){this.engine.resize(),this.plugin_system.lifecycle.resize.emit()}set_style(t,e){this.engine.each(i=>i.set_style(t,e))}apply_style(t){this.engine.each(e=>e.apply_style(t))}format(){this.engine.format(),this.plugin_system.lifecycle.format.emit()}}async function b(n,t){await document.fonts.load(`${t} "${n}"`)}async function w(n){const t=await fetch(n);if(!t.ok)throw new Error("Failed to load resources.");return await t.text()}function k(n,t){return Math.floor(Math.random()*(t-n+1))+n}function $(){if(typeof window>"u")throw new Error("The 'window' object doesn't exist.")}function R(n){return $(),n/100*window.innerWidth}function T(n){return $(),n/100*window.innerHeight}function W(n){return n*parseFloat(getComputedStyle(document.documentElement).fontSize)}function l(n){if(n.endsWith("px"))return parseFloat(n);if(n.endsWith("vw"))return R(parseFloat(n));if(n.endsWith("vh"))return T(parseFloat(n));if(n.endsWith("rem"))return W(parseFloat(n));throw new Error(`Unknown unit: ${n}.`)}function E(n){return l(n)+"px"}const d={font_name:"Sofia",font_size:E("3vh"),track_height:l("8vh"),min_horizontal_gap:l("8vw"),min_vertical_gap:l("4vh"),max_launch_count_per_tick:16,max_row_count:100,alignment:"center",interval:100,danmaku:L(),duration:()=>k(14e3,18e3)},p={track_height:l("20vh"),min_horizontal_gap:l("8vw"),min_vertical_gap:l("4vh"),max_launch_count_per_tick:16,max_row_count:100,alignment:"center",interval:100,danmaku:H(),duration:()=>k(1e4,14e3)},_={font_name:"Aref Ruqaa",font_size:E("3vh"),track_height:l("8vh"),min_horizontal_gap:l("8vw"),min_vertical_gap:l("4vh"),max_launch_count_per_tick:16,max_row_count:100,alignment:"center",interval:100,danmaku:q(),duration:()=>k(14e3,18e3)};async function L(){const n=[],t=(await w("/assets/to_toto.txt")).split(`
`);for(const e of t)n.push({duration:d.duration(),node:[document.createTextNode(e)],style:{fontFamily:d.font_name,fontSize:d.font_size,maxHeight:d.track_height+"px",color:"#f0eaff",border:"1.5px solid #b8aaff",background:"rgba(240, 240, 255, 0.08)",textShadow:"0 0 10px #d6ccff",boxShadow:"0 0 18px rgba(180, 160, 255, 0.25)",padding:"10px 20px",borderRadius:"20px"},loop:!1,direction:"to_left",clone_node:!1});return n}async function H(){const n=[],t=(await w("/assets/img_src.txt")).split(`
`);for(const e of t){const i=document.createElement("img");i.src=e,i.style.maxHeight=p.track_height-4+"px",i.style.display="block",await i.decode(),n.push({duration:p.duration(),node:[i],style:{boxSizing:"border-box",maxHeight:p.track_height+"px",border:"2px solid #a07040"},loop:!1,direction:"to_left",clone_node:!1})}return n}async function q(){const n=[],t=(await w("/assets/quran.txt")).split(`
`);for(const e of t)n.push({duration:_.duration(),node:[document.createTextNode(e)],style:{fontFamily:_.font_name,fontSize:_.font_size,fontWeight:"bold",color:"#fff7ea",background:"linear-gradient(180deg, #2b2f33 0%, #1f2428 100%)",border:"2px solid #c9a84b",borderRadius:"10px",padding:"10px 20px",boxSizing:"border-box",boxShadow:"0 6px 18px rgba(15,18,20,0.55), 0 0 8px rgba(201,168,75,0.20)",textShadow:"0 1px 0 rgba(0,0,0,0.6), 0 0 6px rgba(201,168,75,0.12)",maxHeight:_.track_height+"px"},loop:!1,direction:"to_right",clone_node:!1});return n}async function g(n,t){const e=new M(n);e.mount(t),e.push(await n.danmaku),e.start_render();const i=new ResizeObserver(()=>e.resize());i.observe(document.body),await e.until_all_done(),e.unmount(),i.disconnect()}async function B(){await b(d.font_name,d.font_size),await b(_.font_name,_.font_size);const n=document.getElementById("danmaku-container");if(!n)throw new Error("Can't find the danmaku-container.");await g(d,n),await v("linear-gradient(135deg, #fff8f0 0%, #f5ebdc 100%)","100% 0%"),await g(p,n),await v("radial-gradient(circle at 50% 20%, rgba(201, 168, 75, 0.04), transparent 20%), linear-gradient(180deg, #0f1214 0%, #1b1f22 100%)","0% 0%"),await g(_,n)}async function v(n,t){return new Promise(e=>{const i=document.createElement("div");Object.assign(i.style,{background:n,inset:"0",clipPath:`circle(0% at ${t})`,transition:"clip-path 4s ease-out",zIndex:"999",position:"absolute"}),i.addEventListener("transitionend",()=>{document.body.style.background=n,i.remove(),e()}),document.body.appendChild(i),i.offsetWidth,requestAnimationFrame(()=>i.style.clipPath=`circle(150% at ${t})`)})}await B();</script>
  <style rel="stylesheet" crossorigin>@font-face{font-family:Sofia;src:url(./assets/Sofia-Regular.woff2) format("woff2");font-weight:400;font-style:normal;font-display:block}@font-face{font-family:Aref Ruqaa;src:url(./assets/ArefRuqaa-Regular.woff2) format("woff2");font-weight:400;font-style:normal;font-display:swap}*,*:before,*:after{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%}body{background:linear-gradient(135deg,#000,#1a0028 60%,#2b001a);overflow:hidden}#danmaku-container{width:100%;height:100%}</style>
</head>

<body>
  <div id="danmaku-container">
  </div>
</body>

</html>